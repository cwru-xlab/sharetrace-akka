<?xml version="1.0" encoding="UTF-8"?>
<configuration>
  <appender class="ch.qos.logback.core.rolling.RollingFileAppender" name="file">
    <file>myapp.log</file>
    <immediateFlush>false</immediateFlush>
    <rollingPolicy class="ch.qos.logback.core.rolling.TimeBasedRollingPolicy">
      <fileNamePattern>myapp_%d{yyyy-MM-dd}.log</fileNamePattern>
    </rollingPolicy>
  </appender>

  <!--Ref: https://github.com/logfellow/logstash-logback-encoder#async-appenders-->
  <appender
    class="net.logstash.logback.appender.LoggingEventAsyncDisruptorAppender" name="logstash">
    <appendRetryFrequency>5</appendRetryFrequency> <!--Default: 0-->
    <appendTimeout>-1</appendTimeout> <!--Default: 5ms-->
    <ringBufferSize>8192</ringBufferSize> <!--Default: 8192-->
    <waitStrategyType>blocking</waitStrategyType> <!--Default: blocking-->
    <appender class="ch.qos.logback.core.ConsoleAppender" target="System.out">
      <encoder class="net.logstash.logback.encoder.LogstashEncoder">
        <fieldNames class="net.logstash.logback.fieldnames.ShortenedFieldNames">
          <levelValue>[ignore]</levelValue>
          <logger>[ignore]</logger>
          <thread>[ignore]</thread>
          <version>[ignore]</version>
        </fieldNames>
        <includeMdcKeyName>dummyKeyToExcludeAkkaKeys</includeMdcKeyName>
        <throwableConverter class="net.logstash.logback.stacktrace.ShortenedThrowableConverter">
          <exclude>sun\.reflect\..*\.invoke.*</exclude>
          <exclude>net\.sf\.cglib\.proxy\.MethodProxy\.invoke</exclude>
          <inlineHash>true</inlineHash>
          <maxDepthPerThrowable>30</maxDepthPerThrowable>
          <maxLength>2048</maxLength>
          <rootCauseFirst>true</rootCauseFirst>
          <shortenedClassNameLength>20</shortenedClassNameLength>
        </throwableConverter>
        <timestampPattern>[UNIX_TIMESTAMP_AS_NUMBER]</timestampPattern>
      </encoder>
    </appender>
  </appender>

  <root level="debug">
    <appender-ref ref="logstash"/>
  </root>

</configuration>
